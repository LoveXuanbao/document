### 设置 kerberos 日志轮换

- 在官网和网上找了各种修改kerberos日志级别的文章，均没有修改成功，因此另辟蹊径，从日志轮换中来切割日志，保留7天的日志来减少日志输出

```bash
vim /etc/logrotate.d/krb5kdc

/var/log/krb5kdc.log {
    missingok
    notifempty
    daily
    rotate 7
    compress
    delaycompress
    create 0644 root root
    postrotate
        /bin/kill -HUP `cat /var/run/krb5kdc.pid 2>/dev/null` 2> /dev/null || true
    endscript
}
```

```bash
vim /etc/logrotate.d/kadmind

/var/log/kadmind.log {
    missingok
    notifempty
    daily
    rotate 7
    postrotate
        /bin/kill -HUP `cat /var/run/kadmind.pid 2>/dev/null` 2> /dev/null || true
    endscript
}
```

#### 配置说明

- **missingok**：如果日志文件丢失（即不存在），则不生成错误消息。这常常是为了防止由于日志文件的误删除或其他原因导致的错误；
- **notifempty**：如果日志文件为空，则不进行轮换，这可以节省不必要的磁盘 I/O 和 CPU 资源；
- **daily**：日志文件每天轮换一次，这意味着每天结束时，当前的日志文件将被重命名（并可能压缩），然后创建一个新的日志文件来继续记录；可以设置为 `monthly（每月）`、`weekly（每周）`；
- **rotate 7**：保持最多 7 个旧的日志文件，当达到这个数量时，最旧的日志文件将被删除，这有助于防止磁盘空间被无限期的旧日志文件所占用。
- **compress**：压缩旧的日志文件；
- **delaycompress**：延迟压缩，直到下一次轮转；
- **create 0644 root root**：创建新日志文件时使用的权限和所有者/组  
- **postrotate**：这部分定义了日志轮转后需要执行的命令；这里代表的是执行了一个命令来重新加载 kerberos KDC 的配置，以便它知道新的日志文件位置。
  - **/bin/kill -HUP `cat /var/run/krb5kdc.pid 2>/dev/null` 2> /dev/null**：
    - **cat /var/run/krb5kdc.pid**：读取 /var/run/krb5kdc.pid 文件的内容，这个文件通常包含 kerberos KDC 的进程 ID（PID）；
    - **/bin/kill -HUP**：使用 kill 命令发送一个 HUP（挂起）信号给 kerberos KDC 的进程；这个信号通常用于告诉进程重新加载其配置文件或重新打开其日志文件；
    - **2>/dev/null**：将任何错误消息（例如：如果 /var/run/krb5kdc.pid 文件不存在或无法读取）重定向到 /dev/null，即丢弃它们；
    - **|| true**：如果上述命令失败（即返回非零退出状态码），则 || 后面的 true 命令将被执行，从而确保整个 postrotate 脚本块总是成功退出。这是为了确保日志轮转本身不会因为 postrotate 脚本中的命令失败而失败；