```
#!/bin/bash

read -p "是否创建普通系统用户,如当前系统中只有root一个登录账号，必须要新建一个普通账号。[y/n]:" Y
if [ "$Y" == "y" ];then
        read -p  "请输入用户名称：" A1
        read -p  "请输入'$A1'用户密码：" B1
        useradd $A1
        echo "$B1"|passwd --stdin $A1
        echo "$A1用户已创建完成，密码为 $B1"
        sed -i "/Same/a \ $A1   ALL=(ALL)   NOPASSWD: ALL" /etc/sudoers
        #sed -i '/hsh/a \ynsh   ALL=(ALL)NOPASSWD: ALL' /etc/sudoers
                #sed -i "/Same/a \daadmin   ALL=(ALL)   NOPASSWD: ALL" /etc/sudoers
else
        break
fi
echo "已创建用户完成......"


# 对系统中的用户做检查，加固系统
echo "系统中有登录权限的用户有："
awk -F: '($7=="/bin/bash"){print $1}' /etc/passwd
echo "********************************************"
echo "系统中UID=0的用户有："
awk -F: '($3=="0"){print $1}' /etc/passwd
echo "********************************************"
N=`awk -F: '($2==""){print $1}' /etc/shadow|wc -l`
echo "系统中空密码用户有：$N"
if [ $N -eq 0 ];then
 echo "系统中无空密码用户！！"
 echo "********************************************"
else
 i=1
 while [ $N -gt 0 ]
 do
    None=`awk -F: '($2==""){print $1}' /etc/shadow|awk 'NR=='$i'{print}'`
    echo "------------------------"
    echo $None
    echo "必须为空用户设置密码！！"
    passwd $None
    let N--
 done
 M=`awk -F: '($2==""){print $1}' /etc/shadow|wc -l`
 if [ $M -eq 0 ];then
  echo "系统中已经没有空密码用户了！"
 else
echo "系统中还存在空密码用户：$M"
 fi
fi

# 实现对用户密码策略的设定，如密码最长有效期等
date=`date +%Y-%m-%d`
read -p "是否设置密码策略[y/n]:" Y
if [ "$Y" == "y" ];then
        read -p  "设置密码最多可多少天不修改：" A
        read -p  "设置密码修改之间最小的天数：" B
        read -p  "设置密码最短的长度：" C
        read -p  "设置密码失效前多少天通知用户：" D
        cp /etc/login.defs /etc/login.defs.${date}
        sed -i '/^PASS_MAX_DAYS/c\PASS_MAX_DAYS   '$A'' /etc/login.defs
        sed -i '/^PASS_MIN_DAYS/c\PASS_MIN_DAYS   '$B'' /etc/login.defs
        sed -i '/^PASS_MIN_LEN/c\PASS_MIN_LEN     '$C'' /etc/login.defs
        sed -i '/^PASS_WARN_AGE/c\PASS_WARN_AGE   '$D'' /etc/login.defs
else
        break
fi
echo "已设置好密码策略......"

 echo "********************************************"
#root账户环境变量管理
R=`echo $PATH | sed 's|:|\n|g' | grep "\." `
if [ "$R" == "" ];then
 echo "root账户环境变量，符合系统安全要求！！"
 echo "********************************************"
else
 echo "root账户环境变量，不符合系统安全要求！！"
 echo "********************************************"
fi

#重要文件权限检查
Q=`ls -l /etc/passwd | awk {'print $1'}`
 echo "/etc/passwd 文件权限为     $Q"
 echo "********************************************"
W=`ls -l /etc/shadow | awk {'print $1'}`
 echo "/etc/shadow 文件权限为     $W"
 echo "********************************************"
E=`ls -l /etc/group | awk {'print $1'}`
 echo "/etc/group 文件权限为      $E"
 echo "********************************************"
T=`ls -l /etc/services | awk {'print $1'}`
 echo "/etc/services 文件权限为   $T"
 echo "********************************************"
I=`ls -ld /etc | awk {'print $1'}`
 echo "/etc 目录权限为            $I"
 echo "********************************************"
O=`ls -ld /etc/security | awk {'print $1'}`
 echo "/etc/security 目录权限为   $O"
 echo "********************************************"
P=`ls -ld /etc/rc.d | awk {'print $1'}`
 echo "/etc/rc.d 目录权限为       $P"
 echo "********************************************"

# umask安全管理

Z=`cat /etc/profile | grep -i umask | grep -v default`
Z1=`cat /etc/csh.cshrc | grep -i umask | grep -v default`
Z2=`cat /etc/bashrc | grep -i umask | grep -v default`

 echo "当前系统umask配置为： $Z"
 echo "********************************************"

# 远程登录权限管理

# sed -i 's/#PermitRootLogin yes/PermitRootLogin no/g' /etc/ssh/sshd_config
#if [ $? -eq 0 ];then
# echo "远程登录权限修改完成"
# echo "********************************************"
##else
#fi

#关闭selinux
setenforce 0
sed -i 's/enforcing/disabled/g'  /etc/selinux/config
#时区配置
timedatectl set-timezone Asia/Shanghai
#防火墙配置
systemctl stop firewalld
systemctl disable firewalld
iptables -A INPUT -p ICMP --icmp-type timestamp-request -j DROP
iptables -A INPUT -p ICMP --icmp-type timestamp-reply -j DROP
iptables -A INPUT -p ICMP --icmp-type time-exceeded -j DROP
iptables -A OUTPUT -p ICMP --icmp-type time-exceeded -j DROP
#修改ssh远程端口
# sed -i 's/#Port 22/Port 10022/g' /etc/ssh/sshd_config
# systemctl restart sshd
#配置yum源
parentDir=/etc/yum.repos.d
fileName=nexus
dirAndName="$parentDir/$fileName.repo"
if [ ! -f "$dirAndName" ];then
cd $parentDir
        for file in `ls | grep ".*\.repo$"`; do
                if [[ $file == nexus* ]]; then
                        continue
                fi
        rename .repo .bak $file
        done
cat >> $dirAndName << EOF
[nexus]
name=Nexus Repository
baseurl=http://test:test@10.29.97.44:8081/repository/yum/centos/\$releasever
enabled=1
gpgcheck=0
EOF
echo "文件创建完成"
else
echo "文件已经存在"
fi
```