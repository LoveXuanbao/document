### 一、指定节点

#### 1.1、强制指定

- 简单点的设置可以用 `nodeName` 和 `nodeSelector`

```yaml
spec:
  nodeNmae: master  # 指定 node 名称
  nodeSelector:     # 指定 node 标签
    kubernetes.io/hostname: master
  restartPolicy: Always
  containers:
  ...
```

- 使用亲和性 `nodeAffinity`

```yaml
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:    # terms 里满足一个就可以（或的关系）
        - matchExpressions:   # match 里要全部满足（且的关系）
          - key: kuberentes.io/hostname
            operator: In
            values:
              - master
          - key: kuberentes.io/hostname
            operator: NotIn
            values:
            - master
        - matchExpressions:
          - key: kuberentes.io/hostname
            operator: NotIn
            values:
            - master
```

#### 1.2、尽量满足 

```yaml
spec:
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:  # 尽量满足，可以不满足
      - weight: 10
        preference:
          matchExpressions:
          - key: kuberentes.io/hostname
            operator: In
            values:
              - ssd
```

### 二、分散部署

比如部署 redis、minio、es等集群，希望 pod 尽量不再同一个节点

使用亲和性 `podAntiAffinity`

#### 2.1、强制要求

```yaml
spec:
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - topologyKey: kuberentes.io/hostname    # topologyKey 用来筛选 node，确定一个比较的范围
        labelSelector:
          matchExpressions:
          - key: app
            operator: In
            values:
            - test
```

#### 2.2、尽量满足

```yaml
spec:
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 10
        podAffinityTerm:
          topologyKey: kuberentes.io/hostname
          labelSelector:
            matchExpressions:
            - key: app
              operator: In
              values:
              - test
```

