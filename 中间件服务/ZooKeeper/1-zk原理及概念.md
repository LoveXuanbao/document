## 一、什么是 zookeeper

官方网站：https://zookeeper.apache.org/

ZooKeeper 是一个集中式服务，用户维护配置信息、命名、提供分布式同步、提供组服务。所有这些类型的服务都以某种形式由分布式应用程序使用。每次实施它们时，都需要进行大量工作来修复不可避免地错误和竞争条件。由于实现这些类型地服务很困难，应用程序最初通常会忽略他们，这使得他们在发生变化时变得脆弱并且难以管理。即使正确完成，这些服务的不同实现方式也会导致部署应用程序时的管理复杂性。

ZooKeeper 的目标是将这些不同服务的本质提炼成一个非常简单的集中协调服务接口。服务本身是分布式的并且高度可靠。共识、组管理和存在协议将由服务实现，以便应用程序不需要自己实现它们。这些应用程序的特定用途将由 ZooKeeper 的特定组件和应用程序特定约定的混合组成。

## 二、ZooKeeper 特性

1. **高可用性**：使用了分布式存储和多副本机制来确保高可用性。当一个节点出现故障时，其他节点会自动接管其工作，从而保证系统的运行不受影响。此外，ZooKeeper 还提供了基于 Paxos 算法的 Leader 选举机制，确保在任何时候都有一个可用的 Leader 节点来处理客户端请求；
2. **可靠性**：ZooKeeper 使用了事物和版本号机制来确保数据的可靠性。在写入数据时，ZooKeeper 会为每次写操作生成一个唯一的事务 ID，并记录该事务 ID 的版本号。当其他节点读取该数据时，ZooKeeper 会比较版本号，如果发现版本不一致，则说明该数据已经被修改过，需要重新获取最新的数据；
3. **可扩展性**：ZooKeeper 支持动态添加节点，并可以根据负载情况自动调整节点数量。此外，ZooKeeper 还提供了分布式锁和分布式队列等机制，帮助用户实现更复杂的应用程序；
4. **顺序性**：ZooKeeper 对所有请求都进行了严格的顺序化处理，即使是异步请求也会按照严格的顺序执行。这样可以避免并发访问导致的数据不一致问题，并且可以保证所有客户端看到的数据顺序是一致的。

## 三、ZooKeeper 使用场景

1. **数据同步**：ZooKeeper 可以帮助分布式应用程序实现数据同步功能。每个节点处理存储数据内容和 node 节点状态信息之外，还存储了已经注册的 APP 的状态信息，当有些节点或 APP 不可用，就将当前状态同步为其他服务。例如，在一个分布式系统中，多个节点需要对同一份数据进行读写操作，那么可以使用 ZooKeeper 来实现数据的协调和同步；
2. **配置管理**：ZooKeeper 还可以用于实现配置管理功能。现在我们大多数应用都是采用的分布式开发的应用，搭建到不同的服务器上，我们的配置文件，同一个应用程序的配置文件一样，还有就是多个程序存在相同的配置，当我们配置文件中有个配置属性需要改变，我们需要改变每个程序的配置属性，这样会很麻烦的去修改配置，那么可以使用 ZooKeeper 来实现配置中心，ZooKeeper 采用的是推拉相结合的方式：客户端向服务端注册自己需要关注的节点，一旦该节点的数据发生变更，那么服务端就会向客户端发送 Watcher 事件通知，客户端接受到这个消息通知后，需要主动到服务器获取最新的数据。例如，在一个分布式系统中，多个节点需要共享同一份配置信息，那么可以使用 ZooKeeper 来存储和更新配置信息，并且可以通过监视机制及时通知其他节点更新；
3. **命名服务**：ZooKeeper 还可以作为命名服务使用。命名服务是分布式系统中比较常见的一类场景。命名服务是分布式系统中最基本的功能服务之一，在分布式系统中，被命名的实体通常可以是集群中的机器、提供的服务地址或远程对象等；这些我们统称它们为名字（Name），其中较为常见的就是一些分布式服务框架（如 RPC、RMI）中的服务地址列表，通过使用命名空间服务，客户端应用能够根据指定名字来获取资源的实体、服务地址和提供者的信息等。例如，在一个分布式系统中，多个节点需要访问同一份资源，但是不知道该资源的具体位置，那么可以使用 ZooKeeper 来存储资源名称和位置之间的映射关系；
4. **分布式锁**：ZooKeeper 提供了分布式锁机制，可以帮助分布式应用程序实现并发控制和同步。例如，在一个分布式系统中，多个节点需要对同一份数据进行修改操作，但是仅希望其中一个节点能过获得写锁，避免多个节点同时修改导致数据不一致的问题。这时可以使用 ZooKeeper 的分布式锁机制来实现；
5. **分布式队列**：ZooKeeper 提供了分布式队列机制，可以帮助应用程序实现任务调度和消息传递等功能。例如，在一个分布式系统中，多个节点需要消费同一个任务队列中的人物，那么可以使用 ZooKeeper 的分布式队列机制来保证任务的顺序性和不重复性。





